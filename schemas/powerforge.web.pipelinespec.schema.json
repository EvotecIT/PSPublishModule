{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "powerforge.web.pipelinespec.schema.json",
  "title": "PowerForge Web PipelineSpec (schema v1)",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "$schema": { "type": "string" },
    "SchemaVersion": { "type": "integer", "minimum": 1 },
    "cache": { "type": "boolean" },
    "cachePath": { "type": "string" },
    "profile": { "type": "boolean" },
    "profilePath": { "type": "string" },
    "steps": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/PipelineStep" }
    }
  },
  "required": ["steps"],
  "$defs": {
    "PipelineStep": {
      "type": "object",
      "oneOf": [
        { "$ref": "#/$defs/BuildStep" },
        { "$ref": "#/$defs/VerifyStep" },
        { "$ref": "#/$defs/MarkdownFixStep" },
        { "$ref": "#/$defs/ApiDocsStep" },
        { "$ref": "#/$defs/ChangelogStep" },
        { "$ref": "#/$defs/LlmsStep" },
        { "$ref": "#/$defs/SitemapStep" },
        { "$ref": "#/$defs/OptimizeStep" },
        { "$ref": "#/$defs/AuditStep" },
        { "$ref": "#/$defs/DotNetBuildStep" },
        { "$ref": "#/$defs/DotNetPublishStep" },
        { "$ref": "#/$defs/OverlayStep" }
      ]
    },
    "BuildStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "build" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "config": { "type": "string" },
        "out": { "type": "string" },
        "output": { "type": "string" },
        "clean": {
          "type": "boolean",
          "description": "When true, delete existing output contents before writing new build artifacts."
        }
      },
      "required": ["task", "config", "out"]
    },
    "VerifyStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "verify" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "config": { "type": "string" }
      },
      "required": ["task", "config"]
    },
    "MarkdownFixStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "markdown-fix" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "config": { "type": "string" },
        "root": { "type": "string" },
        "path": { "type": "string" },
        "siteRoot": { "type": "string" },
        "include": { "type": "string" },
        "exclude": { "type": "string" },
        "apply": { "type": "boolean" }
      },
      "required": ["task"]
    },
    "ApiDocsStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "apidocs" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "type": { "type": "string", "enum": ["CSharp", "PowerShell"] },
        "xml": { "type": "string" },
        "help": { "type": "string" },
        "helpPath": { "type": "string" },
        "assembly": { "type": "string" },
        "out": { "type": "string" },
        "output": { "type": "string" },
        "title": { "type": "string" },
        "baseUrl": { "type": "string" },
        "format": { "type": "string", "enum": ["json", "hybrid", "html", "both"] },
        "css": { "type": "string" },
        "headerHtml": { "type": "string" },
        "footerHtml": { "type": "string" },
        "template": { "type": "string" },
        "templateRoot": { "type": "string" },
        "templateIndex": { "type": "string" },
        "templateType": { "type": "string" },
        "templateDocsIndex": { "type": "string" },
        "templateDocsType": { "type": "string" },
        "docsScript": { "type": "string" },
        "searchScript": { "type": "string" },
          "docsHome": { "type": "string" },
          "docsHomeUrl": { "type": "string" },
          "sidebar": { "type": "string", "enum": ["left", "right"] },
          "sidebarPosition": { "type": "string", "enum": ["left", "right"] },
          "bodyClass": { "type": "string" },
          "body-class": { "type": "string" },
          "sourceRoot": { "type": "string" },
        "sourceUrl": { "type": "string" },
        "includeUndocumented": { "type": "boolean" },
        "nav": { "type": "string" },
        "navJson": { "type": "string" },
        "includeNamespace": { "type": "string" },
        "excludeNamespace": { "type": "string" },
        "includeType": { "type": "string" },
        "excludeType": { "type": "string" }
      },
      "required": ["task", "out"]
    },
    "ChangelogStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "changelog" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "source": { "type": "string", "enum": ["Auto", "File", "GitHub"] },
        "changelog": { "type": "string" },
        "changelogPath": { "type": "string" },
        "repo": { "type": "string" },
        "repoUrl": { "type": "string" },
        "token": { "type": "string" },
        "max": { "type": ["string", "integer"] },
        "title": { "type": "string" },
        "out": { "type": "string" },
        "output": { "type": "string" }
      },
      "required": ["task", "out"]
    },
    "LlmsStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "llms" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "siteRoot": { "type": "string" },
        "project": { "type": "string" },
        "apiIndex": { "type": "string" },
        "apiBase": { "type": "string" },
        "name": { "type": "string" },
        "package": { "type": "string" },
        "packageId": { "type": "string" },
        "version": { "type": "string" },
        "quickstart": { "type": "string" },
        "overview": { "type": "string" },
        "license": { "type": "string" },
        "targets": { "type": "string" },
        "extra": { "type": "string" },
        "apiLevel": { "type": "string", "enum": ["None", "Summary", "Full"] },
        "apiMaxTypes": { "type": "integer", "minimum": 0 },
        "apiMaxMembers": { "type": "integer", "minimum": 0 }
      },
      "required": ["task", "siteRoot"]
    },
    "SitemapStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "sitemap" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "siteRoot": { "type": "string" },
        "baseUrl": { "type": "string" },
        "apiSitemap": { "type": "string" },
        "out": { "type": "string" },
        "output": { "type": "string" },
        "entries": { "type": "array", "items": { "$ref": "#/$defs/SitemapEntry" } },
        "includeHtmlFiles": { "type": "boolean" },
        "includeTextFiles": { "type": "boolean" },
        "extraPaths": { "type": "array", "items": { "type": "string" } },
        "html": { "type": "boolean" },
        "htmlOutput": { "type": "string" },
        "htmlOut": { "type": "string" },
        "htmlTemplate": { "type": "string" },
        "htmlCss": { "type": "string" },
        "htmlTitle": { "type": "string" }
      },
      "required": ["task", "siteRoot", "baseUrl"]
    },
    "OptimizeStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "optimize" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "siteRoot": { "type": "string" },
        "config": { "type": "string" },
        "criticalCss": { "type": "string" },
        "cssPattern": { "type": "string" },
        "minifyHtml": { "type": "boolean" },
        "minifyCss": { "type": "boolean" },
        "minifyJs": { "type": "boolean" },
        "optimizeImages": { "type": "boolean" },
        "images": { "type": "boolean" },
        "imageExtensions": { "type": "array", "items": { "type": "string" } },
        "image-ext": { "type": "array", "items": { "type": "string" } },
        "imageInclude": { "type": "array", "items": { "type": "string" } },
        "image-include": { "type": "array", "items": { "type": "string" } },
        "imageExclude": { "type": "array", "items": { "type": "string" } },
        "image-exclude": { "type": "array", "items": { "type": "string" } },
        "imageQuality": { "type": "integer", "minimum": 1, "maximum": 100 },
        "image-quality": { "type": "integer", "minimum": 1, "maximum": 100 },
        "imageStripMetadata": { "type": "boolean" },
        "image-strip-metadata": { "type": "boolean" },
        "imageGenerateWebp": { "type": "boolean" },
        "image-generate-webp": { "type": "boolean" },
        "imageGenerateAvif": { "type": "boolean" },
        "image-generate-avif": { "type": "boolean" },
        "imagePreferNextGen": { "type": "boolean" },
        "image-prefer-nextgen": { "type": "boolean" },
        "imageWidths": { "type": "array", "items": { "type": "integer", "minimum": 1 } },
        "image-widths": { "type": "array", "items": { "type": "integer", "minimum": 1 } },
        "imageEnhanceTags": { "type": "boolean" },
        "image-enhance-tags": { "type": "boolean" },
        "imageMaxBytesPerFile": { "type": "integer", "minimum": 0 },
        "image-max-bytes": { "type": "integer", "minimum": 0 },
        "imageMaxTotalBytes": { "type": "integer", "minimum": 0 },
        "image-max-total-bytes": { "type": "integer", "minimum": 0 },
        "imageFailOnBudget": { "type": "boolean" },
        "image-fail-on-budget": { "type": "boolean" },
        "hashAssets": { "type": "boolean" },
        "hashExtensions": { "type": "array", "items": { "type": "string" } },
        "hashExclude": { "type": "array", "items": { "type": "string" } },
        "hashManifest": { "type": "string" },
        "reportPath": { "type": "string" },
        "report-path": { "type": "string" },
        "cacheHeaders": { "type": "boolean" },
        "cacheHeadersOut": { "type": "string" },
        "cacheHeadersHtml": { "type": "string" },
        "cacheHeadersAssets": { "type": "string" },
        "cacheHeadersPaths": { "type": "array", "items": { "type": "string" } }
      },
      "required": ["task", "siteRoot"]
    },
    "AuditStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "audit" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "siteRoot": { "type": "string" },
        "include": { "type": "string" },
        "exclude": { "type": "string" },
        "noDefaultExclude": { "type": "boolean" },
        "ignoreNav": { "type": "string" },
        "noDefaultIgnoreNav": { "type": "boolean" },
        "navSelector": { "type": "string" },
        "navRequired": { "type": "boolean" },
        "navOptional": { "type": "boolean" },
        "navIgnorePrefixes": { "type": "string" },
        "navRequiredLinks": {
          "type": "string",
          "description": "Comma-separated list of links that must exist in each audited nav."
        },
        "navRequiredLink": {
          "type": "string",
          "description": "Deprecated alias for navRequiredLinks."
        },
        "minNavCoveragePercent": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100
        },
        "min-nav-coverage": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100
        },
        "requiredRoutes": {
          "type": "string",
          "description": "Comma-separated list of routes that must resolve in generated output."
        },
        "required-routes": {
          "type": "string",
          "description": "Deprecated alias for requiredRoutes."
        },
        "requiredRoute": {
          "type": "string",
          "description": "Deprecated alias for requiredRoutes."
        },
        "required-route": {
          "type": "string",
          "description": "Deprecated alias for requiredRoutes."
        },
        "checkLinks": { "type": "boolean" },
        "checkAssets": { "type": "boolean" },
        "checkNav": { "type": "boolean" },
        "checkTitles": { "type": "boolean" },
        "checkDuplicateIds": { "type": "boolean" },
        "checkHtmlStructure": { "type": "boolean" },
        "rendered": { "type": "boolean" },
        "renderedEngine": { "type": "string" },
        "renderedEnsureInstalled": { "type": "boolean" },
        "renderedHeadless": { "type": "boolean" },
        "renderedBaseUrl": { "type": "string" },
        "renderedHost": { "type": "string" },
        "renderedPort": { "type": "integer", "minimum": 0 },
        "renderedServe": { "type": "boolean" },
        "renderedMaxPages": { "type": "integer", "minimum": 0 },
        "renderedTimeoutMs": { "type": "integer", "minimum": 0 },
        "renderedCheckConsoleErrors": { "type": "boolean" },
        "renderedCheckConsoleWarnings": { "type": "boolean" },
        "renderedCheckFailedRequests": { "type": "boolean" },
        "renderedInclude": { "type": "string" },
        "renderedExclude": { "type": "string" },
        "summary": { "type": "boolean" },
        "summaryPath": { "type": "string" },
        "summaryMaxIssues": { "type": "integer", "minimum": 0 },
        "baselinePath": { "type": "string" },
        "baseline": { "type": "string" },
        "failOnWarnings": { "type": "boolean" },
        "failOnNewIssues": { "type": "boolean" },
        "failOnNew": { "type": "boolean" },
        "maxErrors": { "type": "integer" },
        "maxWarnings": { "type": "integer" },
        "failOnCategories": { "type": "string" },
        "failCategories": { "type": "string" },
        "navCanonicalPath": { "type": "string" },
        "navCanonical": { "type": "string" },
        "navCanonicalSelector": { "type": "string" },
        "navCanonicalRequired": { "type": "boolean" },
        "checkUtf8": { "type": "boolean" },
        "checkMetaCharset": { "type": "boolean" },
        "checkUnicodeReplacementChars": { "type": "boolean" },
        "baselineGenerate": { "type": "boolean" },
        "baselineUpdate": { "type": "boolean" }
      },
      "required": ["task", "siteRoot"]
    },
    "DotNetBuildStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "dotnet-build" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "project": { "type": "string" },
        "configuration": { "type": "string" },
        "framework": { "type": "string" },
        "runtime": { "type": "string" },
        "noRestore": { "type": "boolean" }
      },
      "required": ["task", "project"]
    },
    "DotNetPublishStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "dotnet-publish" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "project": { "type": "string" },
        "out": { "type": "string" },
        "output": { "type": "string" },
        "configuration": { "type": "string" },
        "framework": { "type": "string" },
        "runtime": { "type": "string" },
        "clean": {
          "type": "boolean",
          "description": "When true, clear dotnet publish output to prevent stale files from previous runs."
        },
        "selfContained": { "type": "boolean" },
        "noBuild": { "type": "boolean" },
        "noRestore": { "type": "boolean" },
        "baseHref": { "type": "string" },
        "defineConstants": { "type": "string" },
        "noBlazorFixes": { "type": "boolean" }
      },
      "required": ["task", "project", "out"]
    },
    "OverlayStep": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": { "const": "overlay" },
        "id": { "type": "string" },
        "dependsOn": { "oneOf": [{ "type": "string" }, { "type": "array", "items": { "type": "string" } }] },
        "source": { "type": "string" },
        "destination": { "type": "string" },
        "clean": { "type": "boolean" },
        "include": { "type": "string" },
        "exclude": { "type": "string" }
      },
      "required": ["task", "source", "destination"]
    },
    "SitemapEntry": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "path": { "type": "string" },
        "route": { "type": "string" },
        "url": { "type": "string" },
        "priority": { "type": "string" },
        "changefreq": { "type": "string" },
        "changeFrequency": { "type": "string" },
        "lastmod": { "type": "string" },
        "lastModified": { "type": "string" }
      }
    }
  }
}
